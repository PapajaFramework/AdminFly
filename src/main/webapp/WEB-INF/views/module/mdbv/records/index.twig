{% extends '../layout-link.twig' %}
{% import '../../../shared/macro/fields.twig' as fields %}
{% import '../../../shared/macro/pagination.twig' as pagi %}
{% block title %}MongoDB Viewer | {{ 'label.records' | translate }}{% endblock %}
{% block content %}
    <div class="page-header mb-4">
        <h1 id="tables">{{ 'label.records' | translate }} [{{ activeSource.name }}]</h1>
    </div>
    <div class="card border-light mb-3">
        <div class="card-body">
            <form method="get" action="{{ url('/mdbv/records') }}" class="form-inline my-2 my-lg-0 float-left">
                <input id="queryInput" class="form-control mr-sm-2 form-control" type="text" name="query" value="{{ queryString }}" placeholder="{{ queryPath }}">
                <input type="hidden" name="path" id="queryPath" value="{{ queryPath }}">
                <input type="hidden" name="type" id="queryType" value="{{ queryType }}">
                <div class="btn-group btn-group-sm" role="group" aria-label="Button group with nested dropdown">
                    <button type="submit" class="btn btn-success">{{ 'label.search' | translate }}</button>
                    <div class="btn-group" role="group">
                        <button id="pathItems" type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
                        <div class="dropdown-menu" aria-labelledby="pathItems">
                            {% for path in paths %}
                                <a class="dropdown-item" onclick="setPathToSearch('{{ path.path }}', '{{ path.type }}')">{{ path.name }}</a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="card border-light mb-3">
                <div class="card-header">
                    {% include '../partials/setting-header-buttons.twig' %}
                </div>
                <div class="card-body">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th scope="col">{{ 'label.id' | translate }}</th>
                            <th scope="col">[{{ 'label.database' | translate }}].[{{ 'label.collection' | translate }}]</th>
                            <th scope="col" class="w-25"></th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for record in records %}
                            {% set view = url('/mdbv/records/view/' ~ record.getId()) %}
                            <tr>
                                <td>
                                    [{{ record.getId() }}]
                                </td>
                                <td>
                                   db.{{ activeSource.database }}.{{ activeSource.collection }}
                                </td>
                                <td class="text-lg-right">
                                    <button type="button" onclick="location.href='{{ view }}'"
                                            class="btn btn-sm btn-primary">{{ 'label.view' | translate }}</button>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="card-footer">
                    {{ pagi.pagination(pagination.total, pagination.size, pagination.current, url('/mdbv/records', app.request.query, {page : ''}), 12, 4) }}
                </div>
            </div>
        </div>
    </div>
    <script>
        function setPathToSearch(path, type) {
            let queryPath = document.getElementById("queryPath");
            let queryInput = document.getElementById("queryInput");
            let queryType = document.getElementById("queryType");

            queryInput.removeAttribute("value");
            queryInput.setAttribute("placeholder", path);

            queryPath.setAttribute("value", path);
            queryType.setAttribute("value", type);
        }
    </script>
{% endblock %}