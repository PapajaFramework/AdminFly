{% extends '../layout-link.twig' %}
{% import '../../../shared/macro/fields.twig' as fields %}
{% import '../../../shared/macro/pagination.twig' as pagi %}
{% block title %}MongoDB Viewer â€” {{ source.name }}{% endblock %}
{% block content %}
    <div class="page-header mb-4">
        <h1 id="tables">[{{ source.name }}]: {{ source.database }}.{{ source.collection }}</h1>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="card bg-light mb-3">
                <div class="card-header">
                    {% include '../partials/setting-header-buttons.twig' %}
                    <button onclick="switchContent()" type="button" class="btn btn-sm btn-outline-danger">HTML / JSON
                    </button>
                </div>
                <div id="recordContent">
                    <div class="d-block" id="recordRendered">
                        <div class="card-body">
                            <div class="card-title">
                                <h3><b>{{ record.getId() }}</b></h3>
                            </div>
                            {% for path in paths %}
                                {% set value = accessor.get(path.path) %}
                                <h6 class="card-title">
                                    {{ path.name }} [{{ path.type }}]
                                </h6>
                                {% if value is not null %}
                                    <pre class="prettyprint">{% autoescape 'html' %}{{ coders.get(path.type).encode(value) }}{% endautoescape %}</pre>
                                {% else %}
                                    <i>[undefined]</i>
                                {% endif %}
                                <hr class="mt-3 mb-3">
                            {% endfor %}
                        </div>
                    </div>
                    <div class="d-none" id="recordRaw">
                        <div class="card-body">
                            <div class="card-title">
                                <h3><b>{{ record.getId() }}</b></h3>
                            </div>
                            <h6 class="card-title">
                                {{ 'label.raw' | translate }} JSON
                            </h6>
                            <pre id="jsonRecord" class="prettyprint lang-json">{{ jsonRecord }}</pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <link rel="stylesheet" href="{{ asset('js/google-code-prettify/prettify.css') }}">
    <link rel="stylesheet" href="{{ asset('js/google-code-prettify/skins/ih.css') }}">
    <script src="{{ asset('js/google-code-prettify/prettify.js') }}"></script>
    <script>
        function switchContent() {
            let elements = document.querySelectorAll("#recordContent > div");
            let numberOfElements = elements.length;

            for (let i = 0; i < numberOfElements; i++) {
                elements[i].className = elements[i].className === "d-block" ? "d-none" : "d-block";
            }

            return true;
        }

        document.addEventListener("DOMContentLoaded", function () {
            let element = document.getElementById("jsonRecord");
            element.innerText = JSON.stringify(JSON.parse(element.innerText), null, 4);
            PR.prettyPrint();
        });
    </script>
{% endblock %}